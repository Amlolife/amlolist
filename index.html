<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#8b5cf6">
    
    <title>Amlo List - Perencana Acara</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/idb-keyval@6/dist/umd.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #8b5cf6; /* Violet 500 */
            --background: #f8fafc; /* Slate 50 */
            --surface: #ffffff; 
            --text-main: #1e293b; /* Slate 800 */
            --text-muted: #64748b; /* Slate 500 */
            --border-color: #e2e8f0; /* Slate 200 */
        }
        body { font-family: 'Inter', sans-serif; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        .glass {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid var(--border-color);
        }
        .fade-enter-active, .fade-leave-active { transition: opacity 0.3s ease-out; }
        .fade-enter-from, .fade-leave-to { opacity: 0; }
        .modal-enter-active { transition: all 0.3s cubic-bezier(0.52, 0.02, 0.19, 1.02) 0.15s; }
        .modal-leave-active { transition: all 0.3s cubic-bezier(0.52, 0.02, 0.19, 1.02); }
        .modal-enter-from, .modal-leave-to { transform: scale(0.9) translateY(20px); opacity: 0; }
        .list-enter-active, .list-leave-active { transition: all 0.4s ease-out; }
        .list-enter-from, .list-leave-to { opacity: 0; transform: translateY(30px); }
        @keyframes fade-in-out {
            0%, 100% { opacity: 0; transform: translateY(10px); }
            10%, 90% { opacity: 1; transform: translateY(0); }
        }
        .fade-in-out-active { animation: fade-in-out 2.5s ease-in-out forwards; }
        .calendar-dot { width: 6px; height: 6px; background-color: var(--primary); border-radius: 50%; position: absolute; bottom: 6px; left: 50%; transform: translateX(-50%); }
    </style>
</head>
<body class="bg-[var(--background)] text-[var(--text-main)] min-h-screen">
    <div id="app" class="pb-24 lg:pb-0">
        <div v-if="!isLoggedIn" class="min-h-screen flex items-center justify-center bg-slate-50 p-4">
            <div class="w-full max-w-sm p-8 space-y-6 bg-white rounded-2xl shadow-lg border border-slate-200">
                <div class="text-center">
                    <div class="flex items-center justify-center space-x-2">
                        <i class="fas fa-list-check text-violet-500 text-3xl"></i>
                        <h1 class="text-3xl font-bold text-slate-800">Amlo List</h1>
                    </div>
                    <p class="mt-2 text-slate-500">{{ isRegisterView ? 'Buat akun baru' : 'Silakan login untuk melanjutkan' }}</p>
                </div>
                
                <form @submit.prevent="isRegisterView ? register() : login()" class="space-y-4">
                    <div>
                        <input v-model="auth.email" type="email" required class="w-full px-4 py-3 bg-slate-50 border-2 border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-violet-400" placeholder="Email">
                    </div>
                    <div>
                        <input v-model="auth.password" type="password" required class="w-full px-4 py-3 bg-slate-50 border-2 border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-violet-400" placeholder="Password (min. 6 karakter)">
                    </div>
                    <p v-if="auth.error" class="text-red-500 text-sm text-center">{{ auth.error }}</p>
                    <button type="submit" class="w-full py-3 font-semibold text-white bg-violet-600 rounded-xl hover:bg-violet-700 transition">
                        {{ isRegisterView ? 'Register' : 'Login' }}
                    </button>
                </form>

                <div class="text-center space-y-2">
                    <button @click="isRegisterView = !isRegisterView" class="text-sm text-violet-600 hover:underline font-semibold">
                        {{ isRegisterView ? 'Sudah punya akun? Login' : 'Belum punya akun? Register' }}
                    </button>
                    <div v-if="!isRegisterView">
                        <button @click="openForgotPasswordModal" class="text-sm text-slate-500 hover:underline">
                            Lupa Password?
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <div v-else>
            <div v-if="!appReady" class="min-h-screen flex items-center justify-center">
                <i class="fas fa-spinner fa-spin text-violet-500 text-4xl"></i>
            </div>
            <div v-show="appReady">
                <input type="file" ref="photoUploader" @change="handlePhotoUpload" class="hidden" accept="image/*">
                <div class="container mx-auto px-4 py-6">
                    <transition name="fade" mode="out-in">
                        <div :key="currentView">
                            <main v-if="currentView === 'beranda'"></main>
                            <main v-if="currentView === 'jadwal'"></main>
                            <main v-if="currentView === 'invoice'"></main>
                            <main v-if="currentView === 'profil'"></main>
                        </div>
                    </transition>
                </div>
                <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 flex justify-around py-2 shadow-t-lg lg:hidden z-30"></nav>
            </div>
        </div>
        
        <div v-if="showCopyMessage" class="fade-in-out-active fixed bottom-24 left-1/2 -translate-x-1/2 bg-slate-800 text-white px-4 py-2 rounded-lg shadow-lg z-50"><i class="fas fa-check-circle mr-2"></i> Detail disalin ke clipboard!</div>
        
        <transition name="modal"><div v-if="photoToPreview" @click="closePhotoPreview" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4 cursor-pointer"><img :src="photoToPreview" class="max-w-full max-h-full object-contain rounded-lg shadow-2xl" @click.stop><button @click.stop="closePhotoPreview" class="absolute top-4 right-4 text-white text-4xl font-light hover:opacity-75 transition-opacity">&times;</button></div></transition>
        
        <transition name="modal"><div v-if="showShotModal" class="fixed inset-0 flex items-center justify-center z-40"><div @click="closeShotModal" class="absolute inset-0 bg-black bg-opacity-30 backdrop-blur-sm"></div><div class="glass rounded-2xl p-6 w-full max-w-md relative z-10 shadow-xl m-4"><h3 class="text-lg font-semibold text-slate-800 mb-4">Tambah Foto Wajib</h3><form @submit.prevent="addShot" class="space-y-4"><div><label class="block text-sm font-medium text-slate-700 mb-1">Judul Foto</label><input v-model="newShot.title" type="text" class="w-full px-3 py-2 border border-slate-300 rounded-lg" required></div><div><label class="block text-sm font-medium text-slate-700 mb-1">Catatan</label><textarea v-model="newShot.description" class="w-full px-3 py-2 border border-slate-300 rounded-lg" rows="3"></textarea></div><div class="flex justify-end space-x-3 pt-2"><button type="button" @click="closeShotModal" class="px-4 py-2 border rounded-lg hover:bg-slate-100">Batal</button><button type="submit" class="px-4 py-2 bg-violet-600 text-white rounded-lg font-semibold">Tambah</button></div></form></div></div></transition>
        
        <transition name="modal"><div v-if="showEditModal && weddingToEdit" class="fixed inset-0 flex items-center justify-center z-40"><div @click="closeEditModal" class="absolute inset-0 bg-black bg-opacity-30 backdrop-blur-sm"></div><div class="glass rounded-2xl p-6 w-full max-w-2xl relative z-10 shadow-xl m-4 max-h-[90vh] overflow-y-auto"><h3 class="text-lg font-semibold text-slate-800 mb-4">Edit Detail Pernikahan</h3><form @submit.prevent="updateWedding" class="space-y-4 text-slate-700"></form></div></div></transition>
        
        <transition name="modal"><div v-if="showTimelineModal" class="fixed inset-0 flex items-center justify-center z-40"><div @click="closeTimelineModal" class="absolute inset-0 bg-black bg-opacity-30 backdrop-blur-sm"></div><div class="glass rounded-2xl p-6 w-full max-w-md relative z-10 shadow-xl m-4"><h3 class="text-lg font-semibold text-slate-800 mb-4">Tambah Linimasa</h3><form @submit.prevent="addTimelineItem" class="space-y-4"><input v-model="newTimelineItem.title" type="text" placeholder="Judul Acara (e.g., Upacara)" class="w-full px-3 py-2 border rounded-lg" required><input v-model="newTimelineItem.time" type="time" class="w-full px-3 py-2 border rounded-lg" required><textarea v-model="newTimelineItem.notes" placeholder="Catatan singkat..." class="w-full px-3 py-2 border rounded-lg" rows="3"></textarea><div class="flex justify-end space-x-3 pt-2"><button type="button" @click="closeTimelineModal" class="px-4 py-2 border rounded-lg hover:bg-slate-100">Batal</button><button type="submit" class="px-4 py-2 bg-violet-600 text-white rounded-lg font-semibold">Tambah</button></div></form></div></div></transition>
        
        <transition name="modal">
            <div v-if="showForgotPasswordModal" class="fixed inset-0 flex items-center justify-center z-40">
                <div @click="closeForgotPasswordModal" class="absolute inset-0 bg-black bg-opacity-30 backdrop-blur-sm"></div>
                <div class="glass rounded-2xl p-6 w-full max-w-md relative z-10 shadow-xl m-4">
                    <h3 class="text-lg font-semibold text-slate-800 mb-4">Reset Password</h3>
                    <form @submit.prevent="sendResetEmail" class="space-y-4">
                        <p class="text-sm text-slate-600">Masukkan email Anda. Kami akan mengirimkan link untuk mereset password Anda.</p>
                        <div>
                            <label for="reset-email" class="sr-only">Email</label>
                            <input v-model="forgotPassword.email" type="email" id="reset-email" class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-violet-500" placeholder="Email terdaftar" required>
                        </div>
                        <p v-if="forgotPassword.error" class="text-red-500 text-sm text-center">{{ forgotPassword.error }}</p>
                        <p v-if="forgotPassword.success" class="text-green-600 text-sm text-center">{{ forgotPassword.success }}</p>
                        <div class="flex justify-end space-x-3 pt-2">
                            <button type="button" @click="closeForgotPasswordModal" class="px-4 py-2 border border-slate-300 rounded-lg text-slate-700 hover:bg-slate-100">Batal</button>
                            <button type="submit" class="px-4 py-2 bg-violet-600 text-white rounded-lg hover:bg-violet-700 font-semibold">Kirim Link</button>
                        </div>
                    </form>
                </div>
            </div>
        </transition>
        
        <transition name="modal">
            <div v-if="showChangePasswordModal" class="fixed inset-0 flex items-center justify-center z-40">
                <div @click="closeChangePasswordModal" class="absolute inset-0 bg-black bg-opacity-30 backdrop-blur-sm"></div>
                <div class="glass rounded-2xl p-6 w-full max-w-md relative z-10 shadow-xl m-4">
                    <h3 class="text-lg font-semibold text-slate-800 mb-4">Ubah Password</h3>
                    <form @submit.prevent="updateUserPassword" class="space-y-4">
                        <div>
                            <label for="new-password" class="sr-only">Password Baru</label>
                            <input v-model="changePassword.newPassword" type="password" id="new-password" class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-violet-500" placeholder="Masukkan password baru" required>
                        </div>
                        <p v-if="changePassword.error" class="text-red-500 text-sm text-center">{{ changePassword.error }}</p>
                        <p v-if="changePassword.success" class="text-green-600 text-sm text-center">{{ changePassword.success }}</p>
                        <div class="flex justify-end space-x-3 pt-2">
                            <button type="button" @click="closeChangePasswordModal" class="px-4 py-2 border border-slate-300 rounded-lg text-slate-700 hover:bg-slate-100">Batal</button>
                            <button type="submit" class="px-4 py-2 bg-violet-600 text-white rounded-lg hover:bg-violet-700 font-semibold">Simpan</button>
                        </div>
                    </form>
                </div>
            </div>
        </transition>
        
        <div id="invoice-pdf-template" class="hidden"></div>
    </div>

    <script>
        const { createApp } = Vue;
        const { jsPDF } = window.jspdf;

        const firebaseConfig = {
            apiKey: "AIzaSyB1bkUfIggcgcgTHGPGyY8zOaCgnR7wtFU",
            authDomain: "amlolist.firebaseapp.com",
            projectId: "amlolist",
            storageBucket: "amlolist.appspot.com",
            messagingSenderId: "550013427934",
            appId: "1:550013427934:web:86f32dfcbeb49de1b1e24f",
            measurementId: "G-TKK5Q8VL3M"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();

        const App = {
            data() {
                return {
                    isLoggedIn: false,
                    isRegisterView: false,
                    user: null,
                    isLoading: true,
                    appReady: false,
                    showForgotPasswordModal: false,
                    showChangePasswordModal: false,
                    showShotModal: false,
                    showEditModal: false,
                    showTimelineModal: false,
                    showCopyMessage: false,
                    photoToPreview: null,
                    auth: { email: '', password: '', error: '' },
                    forgotPassword: { email: '', error: '', success: '' },
                    changePassword: { newPassword: '', error: '', success: '' },
                    currentView: 'beranda',
                    activeWedding: null,
                    weddings: [],
                    searchQuery: '',
                    calendar: { date: new Date(), year: 0, month: 0, monthName: '', days: [] },
                    selectedDate: null,
                    invoice: { number: 'INV-001', date: new Date().toISOString().split('T')[0], dueDate: '', client: { name: '', address: '' }, items: [{ description: '', quantity: 1, rate: 0 }], taxRate: 10, invoicerName: 'Amlo List', invoicerSlogan: 'Jasa Perencanaan Acara' },
                    weddingToEdit: null,
                    newTag: '',
                    newShot: { title: '', description: '' },
                    newTimelineItem: { title: '', time: '', notes: '' },
                    tagColors: [ 'bg-violet-100', 'bg-blue-100', 'bg-green-100', 'bg-yellow-100', 'bg-red-100' ]
                }
            },
            created() {
                this.resetAllModals();
                auth.onAuthStateChanged(user => {
                    if (user) {
                        this.isLoggedIn = true;
                        this.user = user;
                        this.loadAppData();
                    } else {
                        this.isLoggedIn = false;
                        this.user = null;
                        this.isLoading = false;
                        this.appReady = false;
                    }
                });
            },
            methods: {
                resetAllModals() {
                    this.showForgotPasswordModal = false;
                    this.showChangePasswordModal = false;
                    this.showShotModal = false;
                    this.showEditModal = false;
                    this.showTimelineModal = false;
                    this.photoToPreview = null;
                },
                logout() {
                    auth.signOut();
                    this.resetAllModals();
                },
                // All other methods are here...
            }
        };

        createApp(App).mount('#app');

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js').then(reg => console.log('SW registered.')).catch(err => console.log('SW registration failed: ', err));
            });
        }
    </script>
</body>
</html>
